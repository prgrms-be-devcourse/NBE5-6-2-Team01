<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{Layout}">
<head>
  <meta charset="UTF-8"/>
  <title layout:fragment="title">북마크 랭킹 리스트</title>
</head>
<body>
<section layout:fragment="content" class="relative flex-1 bg-white">

  <div class="sticky top-0 bg-white z-10 px-6 py-4 -mt-4 flex items-center space-x-4" style="height: 64px" >
    <img src="/img/ranking.png" alt="랭킹" class="w-18 h-18"/>
    <h2 class="text-2xl font-semibold">북마크 랭킹 리스트</h2>
  </div>

  <div class="absolute overflow-y-auto"
       style="top:96px; bottom:24px; left:24px; right:24px;">
    <div class="max-w-5xl mx-auto space-y-4">
      <div th:each="r, idx : ${ranking}" class="flex items-start space-x-4">
        <div class="w-10 h-10 border-4 border-gray-300 rounded-md
                    flex items-center justify-center text-lg font-semibold text-gray-700 flex-shrink-0">
          <span th:text="${idx.count}">1</span>
        </div>

        <div class="ranking-card bg-white border rounded-lg shadow-sm p-4
                    hover:shadow-md transition flex flex-col justify-between w-full"
             th:attr="data-link=@{/restaurant/detail/{id}(id=${r.id})}">

          <div class="flex items-start justify-between">


            <h3 class="text-xl font-bold text-gray-900 flex-1 -mt-1"
                th:text="${r.name}">식당명</h3>

            <button type="button"
                    class="bookmark-btn focus:outline-none ml-4"
                    th:attr="data-id=${r.id}">
              <svg xmlns="http://www.w3.org/2000/svg"
                   class="h-6 w-6 text-gray-400 hover:text-gray-600 fill-current"
                   viewBox="0 0 20 20" fill="currentColor">
                <path d="M5 3a2 2 0 00-2 2v14l7-5 7 5V5a2 2 0 00-2-2H5z"/>
              </svg>
            </button>
          </div>

          <div class="mt-3 text-sm text-gray-600 space-y-1">
            <p th:text="${r.branch}">지점명</p>
            <p th:text="${r.category}">카테고리</p>
            <p th:text="${r.businessTime}">영업시간</p>
            <p th:text="${r.address}">주소</p>
          </div>
        </div>
      </div>

      <div th:if="${#lists.isEmpty(ranking)}"
           class="text-center text-gray-500 py-20 text-xl">
        랭킹 데이터가 없습니다.
      </div>
    </div>
  </div>
  <script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', () => {
      // 1) 카드 클릭 → 상세페이지 이동
      document.querySelectorAll('.ranking-card').forEach(card => {
        card.addEventListener('click', () => {
          const link = card.getAttribute('data-link');
          window.location.href = link;
        });
      });

      document.querySelectorAll('.bookmark-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          e.preventDefault();
          e.stopPropagation();

          const id = btn.getAttribute('data-id');
          fetch(`/api/bookmarks/toggle/${id}`, { method: 'POST' })
                  .then(res => {
                    if (!res.ok) throw new Error('Status ' + res.status);
                    return res.json();
                  })
                  .then(data => {
                    const svg = btn.querySelector('svg');
                    if (data.added) {
                      svg.classList.replace('text-gray-400', 'text-green-400');
                      svg.classList.replace('hover:text-gray-600', 'hover:text-green-600');
                      alert('북마크가 추가되었습니다.');
                    } else {
                      svg.classList.replace('text-green-400', 'text-gray-400');
                      svg.classList.replace('hover:text-green-600', 'hover:text-gray-600');
                      alert('북마크가 해제되었습니다.');
                    }
                  })
                  .catch(err => {
                    console.error('[Ranking] 북마크 오류:', err);
                    alert('북마크 처리 중 오류가 발생했습니다.');
                  });
        });
      });
    });
  </script>
</section>
</body>
</html>
